<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Half-Adder Explainer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            color: #e2e8f0;
            touch-action: none;
        }
        .puzzle-container {
            background-color: #1e293b;
            border: 1px solid #3b82f6;
        }
        .bit-display {
            font-family: 'Roboto Mono', monospace;
            transition: all 0.2s ease-in-out;
            user-select: none;
            cursor: pointer;
            width: 56px;
            height: 56px;
            border-radius: 0.375rem;
            border-width: 2px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
        }
        .bit-display.off { background-color: #475569; color: #f87171; border-color: #475569; }
        .bit-display.on { background-color: #1e293b; color: #4ade80; border-color: #4ade80; }
        .bit-display.pulse { animation: pulse-border 1.5s infinite; }
        .circuit-line { stroke: #475569; stroke-width: 4; stroke-linecap: round; transition: stroke 0.2s, filter 0.2s; fill: none; }
        .circuit-line.powered { stroke: #fde047; filter: drop-shadow(0 0 3px #fde047); }
        .gate-symbol { fill: #3b82f6; }
        .gate-text { font-size: 14px; font-weight: bold; fill: white; text-anchor: middle; dominant-baseline: central; pointer-events: none; }
        .draggable-part { cursor: grab; }
        .draggable-part.dragging { cursor: grabbing; opacity: 0.5; }
        .drop-zone { fill: rgba(59, 130, 246, 0.1); stroke: #3b82f6; stroke-width: 2; stroke-dasharray: 4; transition: fill 0.2s; }
        .drop-zone.correct { fill: rgba(74, 222, 128, 0.3); stroke: #4ade80; }
        .touch-drag-clone { position: absolute; pointer-events: none; z-index: 1000; opacity: 0.7; }
        .placed-gate-svg { pointer-events: none; }
        .truth-table th, .truth-table td {
            border: 1px solid #475569; padding: 0.5rem; text-align: center;
            font-family: 'Roboto Mono', monospace; color: #cbd5e1; font-size: 1.125rem;
        }
        .truth-table th { background-color: #334155; }
        .truth-table tr.current { background-color: #3b82f6; color: white; }
        .column-addition {
            font-family: 'Roboto Mono', monospace;
            font-size: 1.5rem;
            line-height: 1.4;
            background-color: #334155;
            padding: 1rem;
            border-radius: 0.375rem;
            width: 120px;
            text-align: right;
        }
        .carry-bit {
            color: #fde047;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }
        .carry-bit.visible {
            opacity: 1;
        }
        
        @keyframes pulse-border {
            0%, 100% { border-color: #4ade80; box-shadow: 0 0 0 0 rgba(74, 222, 128, 0.7); }
            50% { border-color: #86efac; box-shadow: 0 0 10px 2px rgba(74, 222, 128, 0); }
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div id="puzzle-container" class="p-4 sm:p-6 rounded-lg w-full max-w-6xl mx-auto">
        <!-- Content injected by JS -->
    </div>
    
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const puzzleContainer = document.getElementById('puzzle-container');

        // --- GLOBAL STATE ---
        let state = {
            inputs: { A: 0, B: 0 },
            placed: { slot_sum: 'EMPTY', slot_carry: 'EMPTY' },
            isComplete: false,
        };

        // --- DRAG AND DROP LOGIC ---
        let draggedItem = null;
        let touchDragClone = null;

        function makeDraggable(element) {
            element.setAttribute('draggable', 'true');
            element.addEventListener('dragstart', e => {
                if (state.isComplete) return;
                draggedItem = element;
                setTimeout(() => element.classList.add('dragging'), 0);
            });
            element.addEventListener('dragend', () => {
                draggedItem?.classList.remove('dragging');
                draggedItem = null;
            });
            element.addEventListener('touchstart', e => {
                if (state.isComplete) return;
                e.preventDefault();
                draggedItem = element;
                touchDragClone = element.cloneNode(true);
                touchDragClone.classList.add('touch-drag-clone');
                document.body.appendChild(touchDragClone);
                updateClonePosition(e.touches[0]);
            }, { passive: false });
        }

        function makeDroppable(slot) {
            slot.addEventListener('dragover', e => {
                 if (state.isComplete) return;
                 e.preventDefault();
            });
            slot.addEventListener('drop', e => {
                if (state.isComplete) return;
                e.preventDefault();
                if (draggedItem) placeItem(slot, draggedItem);
            });
        }
        
        document.body.addEventListener('touchmove', e => {
            if (!draggedItem || !touchDragClone) return;
            e.preventDefault();
            updateClonePosition(e.touches[0]);
        }, { passive: false });

        document.body.addEventListener('touchend', e => {
            if (!draggedItem || !touchDragClone) return;
            const touch = e.changedTouches[0];
            const dropTarget = document.elementFromPoint(touch.clientX, touch.clientY)?.closest('.drop-target-group');
            if (dropTarget) placeItem(dropTarget, draggedItem);
            document.body.removeChild(touchDragClone);
            touchDragClone = null;
            draggedItem = null;
        });

        function updateClonePosition(touch) {
            if (!touchDragClone) return;
            touchDragClone.style.left = `${touch.clientX - touchDragClone.offsetWidth / 2}px`;
            touchDragClone.style.top = `${touch.clientY - touchDragClone.offsetHeight / 2}px`;
        }

        function placeItem(slot, item) {
            const slotId = slot.id;
            const newGateType = item.dataset.gateType;
            state.placed[slotId] = newGateType;

            const container = slot.querySelector('.placed-gate-container');
            container.innerHTML = '';
            const placedGateSVG = item.querySelector('svg').cloneNode(true);
            placedGateSVG.classList.add('placed-gate-svg');
            
            const slotRect = slot.querySelector('.drop-zone').getBBox();
            const svgWidth = slotRect.width * 0.9;
            const svgHeight = slotRect.height * 0.9;
            placedGateSVG.setAttribute('width', svgWidth);
            placedGateSVG.setAttribute('height', svgHeight);
            placedGateSVG.setAttribute('x', slotRect.x + (slotRect.width - svgWidth) / 2);
            placedGateSVG.setAttribute('y', slotRect.y + (slotRect.height - svgHeight) / 2);
            
            container.appendChild(placedGateSVG);
            updateModule();
        }

        // --- GATE DEFINITIONS ---
        const gateDefs = {
            AND: `<svg viewBox="0 0 60 40"><path d="M10 5 H30 C 45 5, 45 35, 30 35 H10 Z" class="gate-symbol" /><text x="26" y="20" class="gate-text">AND</text></svg>`,
            XOR: `<svg viewBox="0 0 60 40"><path d="M10 5 C 20 5, 30 10, 40 20 C 30 30, 20 35, 10 35 Q 25 20, 10 5 Z" class="gate-symbol"/><path d="M5 5 Q 20 20, 5 35" stroke-width="4" stroke="#3b82f6" fill="none"/><text x="28" y="20" class="gate-text">XOR</text></svg>`,
        };

        const logic = {
            AND: (a, b) => a & b,
            XOR: (a, b) => a ^ b,
            EMPTY: () => 0
        };

        // --- UI RENDERING & UPDATES ---
        function render() {
            const partsHTML = Object.keys(gateDefs).map(key => 
                `<div class="draggable-part w-24 h-20 flex items-center justify-center" data-gate-type="${key}">${gateDefs[key]}</div>`
            ).join('');

            puzzleContainer.innerHTML = `
                <div id="main-instructions" class="text-center mb-4">
                    <h1 class="text-2xl sm:text-3xl font-bold text-white">The Half-Adder</h1>
                    <p class="text-slate-400 max-w-3xl mx-auto mt-2">Your goal: Drag the correct logic gate to each slot. The <strong>AND gate</strong> calculates the Carry, and the <strong>XOR gate</strong> calculates the Sum.</p>
                </div>
                <div id="completion-message" class="hidden text-center mb-4 p-3 bg-green-900/50 border border-green-500 rounded-lg">
                     <h2 class="text-xl font-bold text-green-400">Circuit Built!</h2>
                     <p class="text-slate-300">Now, test your creation. Set both Input A and Input B to 1 to calculate 1 + 1.</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 items-center">
                    <!-- CIRCUIT DIAGRAM -->
                    <div class="lg:col-span-2 bg-slate-800 p-2 sm:p-4 rounded-lg shadow-inner">
                        <svg viewBox="0 0 500 350" class="w-full">
                            <!-- Inputs -->
                            <text x="20" y="85" fill="#e2e8f0" font-size="1.2em">A</text>
                            <foreignObject x="40" y="60" width="60" height="60"><div xmlns="http://www.w3.org/1999/xhtml"><div id="input_A" class="bit-display off">0</div></div></foreignObject>
                            <text x="20" y="285" fill="#e2e8f0" font-size="1.2em">B</text>
                            <foreignObject x="40" y="260" width="60" height="60"><div xmlns="http://www.w3.org/1999/xhtml"><div id="input_B" class="bit-display off">0</div></div></foreignObject>
                            
                            <!-- Wires & Junctions -->
                            <path id="line_a_main" d="M100 90 h20" class="circuit-line" /><circle id="junc_a" cx="120" cy="90" r="5" fill="#475569" />
                            <path id="line_a_to_carry" d="M120 90 h60" class="circuit-line" /><path id="line_a_down" d="M120 90 v180" class="circuit-line" />
                            <path id="line_a_to_sum" d="M120 270 h60" class="circuit-line" />
                            <path id="line_b_main" d="M100 290 h20" class="circuit-line" /><circle id="junc_b" cx="120" cy="290" r="5" fill="#475569" />
                            <path id="line_b_to_sum" d="M120 290 h60" class="circuit-line" /><path id="line_b_up" d="M120 290 v-180" class="circuit-line" />
                            <path id="line_b_to_carry" d="M120 110 h60" class="circuit-line" />

                            <!-- Slots & Labels -->
                            <text x="240" y="50" fill="#94a3b8" text-anchor="middle">Carry Gate (needs AND)</text>
                            <g id="slot_carry" class="drop-target-group" data-expected="AND"><rect class="drop-zone" x="180" y="60" width="120" height="80" rx="5"/><g class="placed-gate-container"></g></g>
                            <text x="240" y="340" fill="#94a3b8" text-anchor="middle">Sum Gate (needs XOR)</text>
                            <g id="slot_sum" class="drop-target-group" data-expected="XOR"><rect class="drop-zone" x="180" y="240" width="120" height="80" rx="5"/><g class="placed-gate-container"></g></g>

                            <!-- Outputs -->
                            <path id="line_carry_out" d="M300 100 h80" class="circuit-line"/><path id="line_sum_out" d="M300 280 h80" class="circuit-line"/>
                            <text x="400" y="80" fill="#e2e8f0">Carry</text>
                            <foreignObject x="390" y="85" width="60" height="60"><div xmlns="http://www.w3.org/1999/xhtml"><div id="output_carry" class="bit-display off">0</div></div></foreignObject>
                            <text x="400" y="260" fill="#e2e8f0">Sum</text>
                            <foreignObject x="390" y="265" width="60" height="60"><div xmlns="http://www.w3.org/1999/xhtml"><div id="output_sum" class="bit-display off">0</div></div></foreignObject>
                        </svg>
                        <div id="parts-bin" class="mt-4 h-24 flex justify-center items-center gap-4 p-2 bg-slate-900/50 rounded-lg border border-slate-700">${partsHTML}</div>
                    </div>

                    <!-- EXPLANATION & TRUTH TABLE -->
                    <div class="flex flex-col gap-6">
                        <div id="explanation-area" class="text-center"></div>
                        <div id="truth-table-container"></div>
                    </div>
                </div>
            `;
            
            // Add event listeners
            document.getElementById('input_A').addEventListener('click', () => { state.inputs.A = 1 - state.inputs.A; updateModule(); });
            document.getElementById('input_B').addEventListener('click', () => { state.inputs.B = 1 - state.inputs.B; updateModule(); });
            document.querySelectorAll('.draggable-part').forEach(makeDraggable);
            document.querySelectorAll('.drop-target-group').forEach(makeDroppable);
            updateModule();
        }

        function updateModule() {
            const { A, B } = state.inputs;
            const carryGate = logic[state.placed.slot_carry] || logic.EMPTY;
            const sumGate = logic[state.placed.slot_sum] || logic.EMPTY;
            
            const carry = carryGate(A, B);
            const sum = sumGate(A, B);
            
            // Update visuals
            powerElement('input_A', A); powerElement('input_B', B);
            powerElement('output_carry', carry); powerElement('output_sum', sum);
            powerLine('line_a_main', A); powerLine('line_a_to_carry', A); powerLine('line_a_down', A); powerLine('line_a_to_sum', A);
            powerLine('line_b_main', B); powerLine('line_b_to_sum', B); powerLine('line_b_up', B); powerLine('line_b_to_carry', B);
            powerLine('line_carry_out', carry); powerLine('line_sum_out', sum);
            const powerJunc = (id, isPowered) => document.getElementById(id)?.setAttribute('fill', isPowered ? '#fde047' : '#475569');
            powerJunc('junc_a', A); powerJunc('junc_b', B);

            // Check correctness of placed gates
            document.querySelectorAll('.drop-target-group').forEach(slot => {
                const placed = state.placed[slot.id];
                if (placed && placed !== 'EMPTY') {
                    slot.querySelector('.drop-zone').classList.toggle('correct', placed === slot.dataset.expected);
                }
            });

            // Check for completion
            if (!state.isComplete && state.placed.slot_carry === 'AND' && state.placed.slot_sum === 'XOR') {
                state.isComplete = true;
                document.getElementById('main-instructions').classList.add('hidden');
                document.getElementById('completion-message').classList.remove('hidden');
                document.getElementById('parts-bin').classList.add('hidden');
                document.getElementById('input_A').classList.add('pulse');
                document.getElementById('input_B').classList.add('pulse');
            }

            updateExplanation(A, B, sum, carry);
            updateTruthTable(A, B);
        }

        function updateExplanation(a, b, sum, carry) {
            const container = document.getElementById('explanation-area');
            let explanationText = '';
            const carryIsVisible = carry === 1;

            if (state.isComplete) {
                 if (a === 1 && b === 1) {
                    explanationText = "Correct! 1 + 1 = 10 in binary. The Sum is 0, and you Carry the 1.";
                 } else {
                    explanationText = "Now set both inputs to 1 to see the final result.";
                 }
            } else {
                explanationText = "Place the gates to see the math in action.";
            }

            container.innerHTML = `
                <div class="column-addition mx-auto">
                    <div><span class="carry-bit ${carryIsVisible ? 'visible' : ''}">1</span>&nbsp;</div>
                    <div>&nbsp;${a}</div>
                    <div>+ ${b}</div>
                    <div class="border-b-2 border-slate-400 my-1"></div>
                    <div>${carryIsVisible ? carry : ''}${sum}</div>
                </div>
                <p class="mt-4 text-slate-400">${explanationText}</p>
            `;
        }
        
        function updateTruthTable(currentA, currentB) {
            const container = document.getElementById('truth-table-container');
            const combinations = [
                {a: 0, b: 0, s: 0, c: 0}, {a: 0, b: 1, s: 1, c: 0},
                {a: 1, b: 0, s: 1, c: 0}, {a: 1, b: 1, s: 0, c: 1},
            ];
            const rows = combinations.map(combo => {
                const isCurrent = (combo.a === currentA && combo.b === currentB);
                return `<tr class="${isCurrent ? 'current' : ''}"><td>${combo.a}</td><td>${combo.b}</td><td>${combo.c}</td><td>${combo.s}</td></tr>`;
            }).join('');
            container.innerHTML = `
                <h2 class="text-xl font-bold text-white mb-2 text-center">Truth Table</h2>
                <table class="truth-table mx-auto">
                    <thead><tr><th>A</th><th>B</th><th>Carry</th><th>Sum</th></tr></thead>
                    <tbody>${rows}</tbody>
                </table>`;
        }

        function powerElement(id, isPowered) {
            const el = document.getElementById(id);
            if (el) {
                el.classList.toggle('on', !!isPowered);
                el.classList.toggle('off', !isPowered);
                el.textContent = isPowered ? '1' : '0';
            }
        }

        function powerLine(id, isPowered) {
            const el = document.getElementById(id);
            if (el) el.classList.toggle('powered', !!isPowered);
        }

        // --- INITIALIZE ---
        render();
    });
    </script>
</body>
</html>

