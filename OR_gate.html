<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>How an OR Gate Works - Interactive</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827;
            color: #d1d5db;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 1rem;
        }
        .puzzle-container {
            background-color: #0f172a;
            padding: 1.5rem;
            border-radius: 0.5rem;
            border: 1px solid #be185d;
            width: 95%;
            max-width: 650px;
            text-align: center;
        }
        .circuit-bg { background-color: #1e293b; }

        .bit-display {
            width: 60px; height: 60px; border-radius: 0.5rem; border: 4px solid #475569;
            font-family: 'Roboto Mono', monospace; font-size: 1.8rem; font-weight: bold;
            display: flex; align-items: center; justify-content: center;
            transition: all 0.2s ease-in-out;
            cursor: pointer; user-select: none;
        }
        .bit-display.input.off, .bit-display.output.off { background-color: #475569; color: #f43f5e; }
        .bit-display.input.on, .bit-display.output.on { background-color: #1e293b; color: #4ade80; border-color: #4ade80; }

        .circuit-line { stroke: #475569; stroke-width: 6; stroke-linecap: round; transition: stroke 0.3s, filter 0.3s; }
        .circuit-line.powered { stroke: #facc15; filter: drop-shadow(0 0 4px #facc15); }
        .circuit-line.control-powered { stroke: #4ade80; filter: drop-shadow(0 0 4px #4ade80); }
        .circuit-text { font-family: 'Roboto Mono', monospace; fill: #94a3b8; font-size: 14px; user-select: none;}
        
        .transistor-box { fill: #334155; stroke: #be185d; stroke-width: 2; transition: all 0.3s; }
        .transistor-box.active { fill: #166534; filter: drop-shadow(0 0 8px #4ade80); }
        .transistor-text { fill: #be185d; font-weight: bold; font-size: 24px; user-select: none; }
        
        .draggable-part { cursor: grab; }
        .draggable-part.dragging { cursor: grabbing; transform: scale(1.1); opacity: 0.7; position: absolute; z-index: 1000; pointer-events: none; }
        .drop-zone { fill: rgba(139, 92, 246, 0.2); stroke: #a78bfa; stroke-width: 2; stroke-dasharray: 4; transition: fill 0.2s; }
        
        .truth-table th, .truth-table td {
            border: 1px solid #475569; padding: 0.5rem; text-align: center;
            font-family: 'Roboto Mono', monospace; color: #cbd5e1; font-size: 1.125rem;
        }
        .truth-table th { background-color: #334155; }
        .truth-table tr.discovered { color: #86efac; font-weight: bold; }
    </style>
</head>
<body>

    <div id="puzzle-container" class="puzzle-container">
        <!-- Content will be injected by JavaScript -->
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const puzzleState = {
                mode: 'build',
                placedParts: 0,
                title: 'Building an OR Gate',
                buildText: "An OR gate's output is ON if <strong>any</strong> input is ON. Drag transistors into the slots to complete the two parallel paths for the electricity.",
                testText: "Perfect! The output is ON (1) if power can flow through the top path <strong>OR</strong> the bottom path. Test all four combinations to see this in action.",
                truthTable: {},
                discoveredCombinations: new Set(),
            };

            const transistorPartSvg = `
                <div id="draggable-transistor-a" class="draggable-part" data-type="transistor-a"><svg width="80" height="40" viewBox="0 0 80 40"><rect class="transistor-box" width="80" height="40" rx="5" /><text class="transistor-text" x="40" y="27" text-anchor="middle">T</text></svg></div>
                <div id="draggable-transistor-b" class="draggable-part" data-type="transistor-b"><svg width="80" height="40" viewBox="0 0 80 40"><rect class="transistor-box" width="80" height="40" rx="5" /><text class="transistor-text" x="40" y="27" text-anchor="middle">T</text></svg></div>
            `;
            
            const orCircuitSchematic = `
                <svg viewBox="0 0 500 300" class="w-full">
                    <!-- PATH A (TOP) -->
                    <path id="power-to-a" d="M90 100 H 180" class="circuit-line powered" />
                    <path id="control-line-a" d="M80 100 H 180" class="circuit-line" />
                    <g transform="translate(180, 80)">
                        <rect id="drop-zone-a" class="drop-zone" data-type="transistor-a" width="80" height="40" rx="5" />
                        <g id="placed-transistor-a" style="visibility: hidden;">
                            <rect id="transistor-box-a" class="transistor-box" width="80" height="40" rx="5" />
                            <text class="transistor-text" x="40" y="27" text-anchor="middle">T</text>
                        </g>
                    </g>
                    <path id="a-to-join" d="M260 100 H 350" class="circuit-line" />

                    <!-- PATH B (BOTTOM) -->
                    <path id="power-to-b" d="M90 220 H 180" class="circuit-line powered" />
                    <path id="control-line-b" d="M80 220 H 180" class="circuit-line" />
                    <g transform="translate(180, 200)">
                        <rect id="drop-zone-b" class="drop-zone" data-type="transistor-b" width="80" height="40" rx="5" />
                        <g id="placed-transistor-b" style="visibility: hidden;">
                            <rect id="transistor-box-b" class="transistor-box" width="80" height="40" rx="5" />
                            <text class="transistor-text" x="40" y="27" text-anchor="middle">T</text>
                        </g>
                    </g>
                    <path id="b-to-join" d="M260 220 H 350" class="circuit-line" />

                    <!-- REJOIN PATHS & OUTPUT -->
                    <path id="rejoin-line" d="M350 100 V 220" class="circuit-line" />
                    <path id="output-line" d="M350 160 H 410" class="circuit-line" />

                    <!-- INPUT CONTROLS -->
                    <foreignObject x="10" y="70" width="70" height="60">
                        <div xmlns="http://www.w3.org/1999/xhtml" id="input-a-wrapper" class="flex flex-col items-center justify-center h-full">
                             <div id="input-a-signal" class="bit-display input off">0</div>
                        </div>
                    </foreignObject>
                    <text x="45" y="145" class="circuit-text" text-anchor="middle">Input A</text>
                    
                    <foreignObject x="10" y="190" width="70" height="60">
                         <div xmlns="http://www.w3.org/1999/xhtml" id="input-b-wrapper" class="flex flex-col items-center justify-center h-full">
                            <div id="input-b-signal" class="bit-display input off">0</div>
                        </div>
                    </foreignObject>
                    <text x="45" y="265" class="circuit-text" text-anchor="middle">Input B</text>

                    <!-- OUTPUT DISPLAY -->
                    <foreignObject x="420" y="130" width="70" height="60">
                        <div xmlns="http://www.w3.org/1999/xhtml" class="flex flex-col items-center justify-center h-full">
                            <div id="output-display" class="bit-display output off">0</div>
                        </div>
                    </foreignObject>
                    <text x="455" y="205" class="circuit-text" text-anchor="middle">Output</text>
                </svg>`;

            function setupPuzzle() {
                const container = document.getElementById('puzzle-container');
                container.innerHTML = `
                    <div id="instruction-text" class="text-center mb-6">
                        <h1 class="text-3xl font-bold text-white">${puzzleState.title}</h1>
                        <p class="text-slate-400 max-w-3xl mx-auto">${puzzleState.buildText}</p>
                    </div>
                    <div class="circuit-bg p-4 sm:p-8 rounded-lg shadow-2xl">
                        <div class="flex flex-col items-center gap-8">
                            <div id="parts-bin-wrapper" class="h-20 flex justify-center items-center">
                                <div id="parts-bin" class="flex gap-4">${transistorPartSvg}</div>
                            </div>
                            <div id="schematic-area" class="w-full">${orCircuitSchematic}</div>
                            <div id="truth-table-container" class="w-full"></div>
                        </div>
                        <div class="mt-6 text-right h-10">
                            <button id="puzzle-complete-btn" class="hidden bg-pink-600 hover:bg-pink-700 text-white font-bold py-2 px-4 rounded">Station Complete!</button>
                        </div>
                    </div>`;
                document.getElementById('input-a-wrapper').style.display = 'none';
                document.getElementById('input-b-wrapper').style.display = 'none';
                setupBuildMode();
                updateTruthTable();
            }

            function setupBuildMode() {
                ['a', 'b'].forEach(id => {
                    const part = document.getElementById(`draggable-transistor-${id}`);
                    let clone = null;
                    const currentDragType = `transistor-${id}`;

                    const startDrag = (e) => {
                        if (puzzleState.mode !== 'build' || part.style.visibility === 'hidden') return;
                        clone = part.cloneNode(true);
                        clone.classList.add('dragging');
                        document.body.appendChild(clone);
                        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                        const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                        clone.style.left = `${clientX - 40}px`;
                        clone.style.top = `${clientY - 20}px`;
                        document.addEventListener('mousemove', moveDrag);
                        document.addEventListener('touchmove', moveDrag);
                        document.addEventListener('mouseup', endDrag, { once: true });
                        document.addEventListener('touchend', endDrag, { once: true });
                    };

                    const moveDrag = (e) => {
                        if (!clone) return;
                        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                        const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                        clone.style.left = `${clientX - 40}px`;
                        clone.style.top = `${clientY - 20}px`;
                    };

                    const endDrag = (e) => {
                        document.removeEventListener('mousemove', moveDrag);
                        document.removeEventListener('touchmove', moveDrag);
                        if (clone) clone.remove();
                        const clientX = e.changedTouches ? e.changedTouches[0].clientX : e.clientX;
                        const clientY = e.changedTouches ? e.changedTouches[0].clientY : e.clientY;
                        const dropTarget = document.elementFromPoint(clientX, clientY);

                        if (dropTarget && dropTarget.dataset.type === currentDragType) {
                            part.style.visibility = 'hidden';
                            document.getElementById(`placed-${currentDragType}`).style.visibility = 'visible';
                            puzzleState.placedParts++;
                            if (puzzleState.placedParts === 2) {
                                switchToTestMode();
                            }
                        }
                    };
                    
                    part.addEventListener('mousedown', startDrag);
                    part.addEventListener('touchstart', (e) => { e.preventDefault(); startDrag(e); }, { passive: false });
                });
            }

            function switchToTestMode() {
                puzzleState.mode = 'test';
                document.querySelector('#instruction-text p').innerHTML = puzzleState.testText;
                document.getElementById('parts-bin-wrapper').classList.add('hidden');
                document.getElementById('input-a-wrapper').style.display = 'flex';
                document.getElementById('input-b-wrapper').style.display = 'flex';
                setupTestLogic();
            }

            function setupTestLogic() {
                const inputA = document.getElementById('input-a-signal');
                const inputB = document.getElementById('input-b-signal');
                let isInputA_On = false;
                let isInputB_On = false;

                const updateCircuit = () => {
                    const isOutputOn = isInputA_On || isInputB_On;

                    inputA.textContent = isInputA_On ? '1' : '0';
                    inputA.classList.toggle('on', isInputA_On);
                    
                    inputB.textContent = isInputB_On ? '1' : '0';
                    inputB.classList.toggle('on', isInputB_On);
                    
                    document.getElementById('output-display').textContent = isOutputOn ? '1' : '0';
                    document.getElementById('output-display').classList.toggle('on', isOutputOn);

                    document.getElementById('control-line-a').classList.toggle('control-powered', isInputA_On);
                    document.getElementById('transistor-box-a').classList.toggle('active', isInputA_On);
                    document.getElementById('a-to-join').classList.toggle('powered', isInputA_On);

                    document.getElementById('control-line-b').classList.toggle('control-powered', isInputB_On);
                    document.getElementById('transistor-box-b').classList.toggle('active', isInputB_On);
                    document.getElementById('b-to-join').classList.toggle('powered', isInputB_On);
                    
                    document.getElementById('rejoin-line').classList.toggle('powered', isOutputOn);
                    document.getElementById('output-line').classList.toggle('powered', isOutputOn);
                    
                    const inputKey = `${isInputA_On ? '1' : '0'}${isInputB_On ? '1' : '0'}`;
                    puzzleState.truthTable[inputKey] = isOutputOn ? '1' : '0';
                    puzzleState.discoveredCombinations.add(inputKey);
                    updateTruthTable();

                    if (puzzleState.discoveredCombinations.size === 4) {
                        document.getElementById('puzzle-complete-btn').classList.remove('hidden');
                    }
                };

                inputA.addEventListener('click', () => { isInputA_On = !isInputA_On; updateCircuit(); });
                inputB.addEventListener('click', () => { isInputB_On = !isInputB_On; updateCircuit(); });
                
                updateCircuit();
            }

            function updateTruthTable() {
                const container = document.getElementById('truth-table-container');
                const combinations = ['00', '01', '10', '11'];
                let rows = '';

                for (const combo of combinations) {
                    const discovered = puzzleState.discoveredCombinations.has(combo);
                    const output = discovered ? puzzleState.truthTable[combo] : '?';
                    const [inputA, inputB] = combo.split('');
                    rows += `<tr class="${discovered ? 'discovered' : ''}"><td>${inputA}</td><td>${inputB}</td><td>${output}</td></tr>`;
                }
                
                container.innerHTML = `
                    <h2 class="text-xl font-bold text-white mb-2">Truth Table</h2>
                    <table class="truth-table mx-auto">
                        <thead><tr><th>Input A</th><th>Input B</th><th>Output</th></tr></thead>
                        <tbody>${rows}</tbody>
                    </table>`;
            }

            setupPuzzle();
        });
    </script>
</body>
</html>

