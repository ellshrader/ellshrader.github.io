<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>How a NOT Gate Works - Interactive</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827;
            color: #d1d5db;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 1rem;
        }
        .puzzle-container {
            background-color: #0f172a;
            padding: 1.5rem 1rem; /* Adjusted padding for mobile */
            border-radius: 0.5rem;
            border: 1px solid #be185d; /* Pink border from factory */
            width: 95%;
            max-width: 500px; /* Capped width for mobile */
            text-align: center;
        }
        .circuit-bg { background-color: #1e293b; }

        .bit-display {
            width: 70px; height: 70px; border-radius: 0.5rem; border: 4px solid #475569;
            font-family: 'Roboto Mono', monospace; font-size: 2rem; font-weight: bold;
            display: flex; align-items: center; justify-content: center;
            transition: all 0.2s ease-in-out;
            cursor: pointer; user-select: none;
        }
        .bit-display.input.off, .bit-display.output.off { background-color: #475569; color: #f43f5e; }
        .bit-display.input.on, .bit-display.output.on { background-color: #1e293b; color: #4ade80; border-color: #4ade80; }

        .circuit-line { stroke: #475569; stroke-width: 6; stroke-linecap: round; transition: stroke 0.3s, filter 0.3s; }
        .circuit-line.powered { stroke: #facc15; filter: drop-shadow(0 0 4px #facc15); } /* Yellow for main power */
        .circuit-line.control-powered { stroke: #4ade80; filter: drop-shadow(0 0 4px #4ade80); } /* Green for control */
        .circuit-text { font-family: 'Roboto Mono', monospace; fill: #94a3b8; font-size: 14px; }
        
        .transistor-box { fill: #334155; stroke: #be185d; stroke-width: 2; transition: all 0.3s; }
        .transistor-box.active { fill: #166534; filter: drop-shadow(0 0 8px #4ade80); }
        .transistor-text { fill: #be185d; font-weight: bold; font-size: 24px; user-select: none; }
        
        /* Drag and Drop Styles */
        .draggable-part { cursor: grab; }
        .draggable-part.dragging { cursor: grabbing; transform: scale(1.1); opacity: 0.7; position: absolute; z-index: 1000; pointer-events: none; }
        .drop-zone { fill: rgba(139, 92, 246, 0.2); stroke: #a78bfa; stroke-width: 2; stroke-dasharray: 4; transition: fill 0.2s; }
        
        /* Truth Table */
        .truth-table th, .truth-table td {
            border: 1px solid #475569; padding: 0.5rem 1rem; text-align: center;
            font-family: 'Roboto Mono', monospace; color: #cbd5e1; font-size: 1.125rem;
        }
        .truth-table th { background-color: #334155; }
        .truth-table tr.discovered { color: #86efac; font-weight: bold; }
    </style>
</head>
<body>

    <div id="puzzle-container" class="puzzle-container">
        <!-- Content will be injected by JavaScript -->
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Puzzle State & Configuration ---
            const puzzleState = {
                mode: 'build', // 'build' or 'test'
                title: 'Building a NOT Gate',
                buildText: "A NOT gate inverts its input. To build one, drag the transistor from the parts bin into the empty slot. It's wired to divert power away from the output.",
                testText: "Great! Now test your circuit. Flip the switch to see how the output changes. When the input is ON (1), the transistor activates and diverts power, turning the output OFF (0). This is inversion!",
                truthTable: {},
                discoveredCombinations: new Set(),
            };

            // --- SVG Schematics ---
            const transistorPartSvg = `<div id="draggable-transistor" class="draggable-part" data-type="transistor"><svg width="80" height="70" viewBox="0 0 80 70"><rect class="transistor-box" width="80" height="70" rx="5" /><text class="transistor-text" x="40" y="42" text-anchor="middle">T</text></svg></div>`;
            const inverterCircuitSchematic = `
                <svg viewBox="0 0 480 220" class="w-full">
                    <!-- Input Display, aligned with input line -->
                    <foreignObject x="45" y="85" width="70" height="70">
                        <div xmlns="http://www.w3.org/1999/xhtml">
                            <div id="input-signal" class="bit-display input off hidden">0</div>
                        </div>
                    </foreignObject>
                    <text x="80" y="170" class="circuit-text" text-anchor="middle">Input</text>

                    <!-- Power Source Line to top of transistor -->
                    <path d="M255 20 V 85" class="circuit-line powered" />

                    <!-- Transistor and Drop Zone -->
                    <g transform="translate(215, 85)">
                        <rect id="drop-zone" class="drop-zone" data-type="transistor" width="80" height="70" rx="5" />
                        <g id="placed-transistor" style="visibility: hidden;">
                            <rect id="transistor-box" class="transistor-box" width="80" height="70" rx="5" />
                            <text class="transistor-text" x="40" y="42" text-anchor="middle">T</text>
                        </g>
                    </g>
                    
                    <!-- Input Path from display to middle-left of transistor -->
                    <path id="input-line" d="M115 120 H 215" class="circuit-line" />
                    
                    <!-- Ground Line from bottom of transistor -->
                    <path id="ground-line" d="M255 155 V 210" class="circuit-line" />
                    <path d="M235 210 h40 M240 215 h30 M245 220 h20" stroke="#94a3b8" stroke-width="2" />

                    <!-- Output Path from middle-right of transistor -->
                    <path id="output-line" d="M295 120 H 365" class="circuit-line" />
                    <text x="405" y="170" class="circuit-text" text-anchor="middle">Output</text>

                    <!-- Output Display, aligned with output line -->
                    <foreignObject x="365" y="85" width="70" height="70">
                        <div xmlns="http://www.w3.org/1999/xhtml">
                            <div id="output-display" class="bit-display output off">0</div>
                        </div>
                    </foreignObject>
                </svg>`;

            function setupPuzzle() {
                const container = document.getElementById('puzzle-container');
                const puzzleHtml = `
                    <div id="instruction-text" class="text-center mb-6">
                        <h1 class="text-3xl font-bold text-white">${puzzleState.title}</h1>
                        <p class="text-slate-400 max-w-3xl mx-auto">${puzzleState.buildText}</p>
                    </div>
                    <div class="circuit-bg p-4 sm:p-2 rounded-lg shadow-2xl">
                        <div class="flex flex-col items-center gap-8">
                            <!-- Top Section: Parts Bin -->
                            <div id="parts-bin-container" class="h-24 flex items-center justify-center">
                                ${transistorPartSvg}
                            </div>
                            <!-- Middle: Schematic -->
                            <div id="schematic-area" class="w-full">${inverterCircuitSchematic}</div>
                            <!-- Bottom: Truth Table -->
                            <div id="truth-table-container" class="w-full"></div>
                        </div>
                        <div class="mt-6 text-right h-10">
                            <button id="puzzle-complete-btn" class="hidden bg-pink-600 hover:bg-pink-700 text-white font-bold py-2 px-4 rounded">Station Complete!</button>
                        </div>
                    </div>`;
                container.innerHTML = puzzleHtml;
                setupBuildMode();
                updateTruthTable();
            }

            function setupBuildMode() {
                const part = document.getElementById('draggable-transistor');
                const dropZone = document.getElementById('drop-zone');
                let clone = null;

                const startDrag = (e) => {
                    if (puzzleState.mode !== 'build') return;
                    
                    clone = part.cloneNode(true);
                    clone.classList.add('dragging');
                    document.body.appendChild(clone);
                    
                    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                    clone.style.left = `${clientX - 40}px`;
                    clone.style.top = `${clientY - 35}px`;

                    document.addEventListener('mousemove', moveDrag);
                    document.addEventListener('mouseup', endDrag, { once: true });
                    document.addEventListener('touchmove', moveDrag);
                    document.addEventListener('touchend', endDrag, { once: true });
                };

                const moveDrag = (e) => {
                    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                    clone.style.left = `${clientX - 40}px`;
                    clone.style.top = `${clientY - 35}px`;
                };

                const endDrag = (e) => {
                    document.removeEventListener('mousemove', moveDrag);
                    document.removeEventListener('mouseup', endDrag);
                    document.removeEventListener('touchmove', moveDrag);
                    document.removeEventListener('touchend', endDrag);
                    
                    const clientX = e.changedTouches ? e.changedTouches[0].clientX : e.clientX;
                    const clientY = e.changedTouches ? e.changedTouches[0].clientY : e.clientY;
                    
                    if (clone) clone.remove();

                    const dropTarget = document.elementFromPoint(clientX, clientY);
                    if (dropTarget && dropTarget.id === 'drop-zone') {
                        part.style.visibility = 'hidden';
                        document.getElementById('placed-transistor').style.visibility = 'visible';
                        switchToTestMode();
                    }
                };
                
                part.addEventListener('mousedown', startDrag);
                part.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    startDrag(e);
                }, { passive: false });
            }

            function switchToTestMode() {
                puzzleState.mode = 'test';
                document.querySelector('#instruction-text p').innerHTML = puzzleState.testText;
                document.getElementById('parts-bin-container').classList.add('hidden');
                document.getElementById('input-signal').classList.remove('hidden');
                setupTestLogic();
            }

            function setupTestLogic() {
                const inputControl = document.getElementById('input-signal');
                const outputDisplay = document.getElementById('output-display');
                let isInputOn = false;

                const updateCircuit = () => {
                    const isOutputOn = !isInputOn;

                    inputControl.textContent = isInputOn ? '1' : '0';
                    inputControl.classList.toggle('on', isInputOn);
                    inputControl.classList.toggle('off', !isInputOn);
                    
                    outputDisplay.textContent = isOutputOn ? '1' : '0';
                    outputDisplay.classList.toggle('on', isOutputOn);
                    outputDisplay.classList.toggle('off', !isOutputOn);

                    const isPowerToOutputOn = !isInputOn;
                    
                    document.getElementById('input-line').classList.toggle('control-powered', isInputOn);
                    document.getElementById('transistor-box').classList.toggle('active', isInputOn);
                    document.getElementById('ground-line').classList.toggle('powered', isInputOn);
                    document.getElementById('output-line').classList.toggle('powered', isPowerToOutputOn);
                    
                    const inputKey = isInputOn ? '1' : '0';
                    puzzleState.truthTable[inputKey] = isOutputOn ? '1' : '0';
                    puzzleState.discoveredCombinations.add(inputKey);
                    updateTruthTable();

                    if (puzzleState.discoveredCombinations.size === 2) {
                        document.getElementById('puzzle-complete-btn').classList.remove('hidden');
                    }
                };

                inputControl.addEventListener('click', () => {
                    isInputOn = !isInputOn;
                    updateCircuit();
                });
                
                updateCircuit();
            }

            function updateTruthTable() {
                const container = document.getElementById('truth-table-container');
                const combinations = ['0', '1'];
                let rows = '';

                for (const combo of combinations) {
                    const discovered = puzzleState.discoveredCombinations.has(combo);
                    const output = discovered ? puzzleState.truthTable[combo] : '?';
                    rows += `<tr class="${discovered ? 'discovered' : ''}"><td>${combo}</td><td>${output}</td></tr>`;
                }
                
                container.innerHTML = `
                    <h2 class="text-xl font-bold text-white mb-2">Truth Table</h2>
                    <table class="truth-table mx-auto">
                        <thead><tr><th>Input</th><th>Output</th></tr></thead>
                        <tbody>${rows}</tbody>
                    </table>`;
            }

            setupPuzzle();
        });
    </script>
</body>
</html>

